{
  "id": "weather_sojson",
  "meta": {
    "name": "è‡ªåŠ¨å¤©æ°” (SoJson)",
    "version": "1.0.0",
    "author": "System",
    "description": "åŸºäºIPå®šä½ï¼Œä½¿ç”¨SoJsonæ¥å£è·å–é«˜ç²¾åº¦å¤©æ°”æ•°æ®"
  },
  "inputs": [
    {
      "key": "city",
      "label": "åŸå¸‚åç§°",
      "type": "text",
      "default": "",
      "placeholder": "ç•™ç©ºåˆ™æ ¹æ®IPè‡ªåŠ¨å®šä½",
      "scope": "target"
    }
  ],
  "execution": {
    "type": "chain",
    "interval": 1800000,
    "steps": [
      {
        "id": "step1_ip",
        "url": "http://whois.pconline.com.cn/ipJson.jsp?json=true",
        "response_encoding": "gbk",
        "cache_minutes": -1,
        "extract": {
          "auto_city": "city"
        },
        "process": [
          {
            "var": "auto_city",
            "function": "regex_replace",
            "pattern": "(å¸‚|åŒº|å¿|çœ)$",
            "to": ""
          },
          {
            "var": "city",
            "source": "city",
            "function": "regex_replace",
            "pattern": "^$",
            "to": "{{auto_city}}" 
          }
        ]
      },
      {
        "id": "step2_code",
        "url": "http://toy1.weather.com.cn/search?cityname={{city}}",
        "headers": {
            "Referer": "http://www.weather.com.cn/"
        },
        "response_format": "jsonp",
        "cache_minutes": -1,
        "extract": {
          "city_ref": "[0].ref"
        },
        "process": [
          {
            "var": "city_code",
            "source": "city_ref",
            "function": "regex_replace",
            "pattern": "^(\\d+)~.*",
            "to": "$1"
          }
        ]
      },
      {
        "id": "step3_weather",
        "url": "http://t.weather.itboy.net/api/weather/city/{{city_code}}",
        "extract": {
          "temp": "data.wendu",
          "type": "data.forecast[0].type",
          "high": "data.forecast[0].high",
          "low": "data.forecast[0].low"
        },
        "process": [
          {
            "var": "weather_text",
            "source": "type",
            "function": "map",
            "map": {
              "æ™´": "â˜€ï¸ æ™´",
              "å¤šäº‘": "â›… å¤šäº‘",
              "é˜´": "â˜ï¸ é˜´",
              "å°é›¨": "ğŸŒ§ï¸ å°é›¨",
              "ä¸­é›¨": "ğŸŒ§ï¸ ä¸­é›¨",
              "å¤§é›¨": "ğŸŒ§ï¸ å¤§é›¨",
              "æš´é›¨": "ğŸŒ§ï¸ æš´é›¨",
              "é˜µé›¨": "ğŸŒ§ï¸ é˜µé›¨",
              "é›·é˜µé›¨": "â›ˆï¸ é›·é˜µé›¨",
              "é›·é˜µé›¨ä¼´æœ‰å†°é›¹": "â›ˆï¸ å†°é›¹",
              "é›¨å¤¹é›ª": "ğŸŒ§ï¸ é›¨å¤¹é›ª",
              "å°é›ª": "â„ï¸ å°é›ª",
              "ä¸­é›ª": "â„ï¸ ä¸­é›ª",
              "å¤§é›ª": "â„ï¸ å¤§é›ª",
              "æš´é›ª": "â„ï¸ æš´é›ª",
              "é˜µé›ª": "â„ï¸ é˜µé›ª",
              "é›¾": "ğŸŒ«ï¸ é›¾",
              "éœ¾": "ğŸŒ«ï¸ éœ¾",
              "æ‰¬æ²™": "ğŸŒ«ï¸ æ‰¬æ²™",
              "æµ®å°˜": "ğŸŒ«ï¸ æµ®å°˜",
              "æ²™å°˜æš´": "ğŸŒ«ï¸ æ²™å°˜æš´",
              "å¼ºæ²™å°˜æš´": "ğŸŒ«ï¸ å¼ºæ²™å°˜æš´"
            }
          },
          {
            "var": "high_clean",
            "source": "high",
            "function": "regex_replace",
            "pattern": "é«˜æ¸© ",
            "to": ""
          },
          {
            "var": "low_clean",
            "source": "low",
            "function": "regex_replace",
            "pattern": "ä½æ¸© ",
            "to": ""
          }
        ]
      }
    ]
  },
  "outputs": [
    {
      "key": "temp",
      "label": "{{city}}æ°”æ¸©",
      "short_label": "{{city}}",
      "format": "{{weather_text}} {{temp}}â„ƒ",
      "unit": ""
    },
    {
      "key": "range",
      "label": "{{city}}æ¸©å·®",
      "short_label": "æ¸©å·®",
      "format": "{{low_clean}}~{{high_clean}}",
      "unit": ""
    }
  ]
}
